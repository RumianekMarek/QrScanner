import{V as c,j as e,M as E,r as s,a as F,h as L}from"./app-DitzYv0W.js";import{A as M,N as b}from"./AuthenticatedLayout-p7kGfUna.js";import{P as h}from"./PrimaryButton-Beg2bFnm.js";import A from"./CameraAcces-C6Tj-Sd2.js";import O from"./DeviceScannerAcces-CVrCyu0v.js";import{T as Q}from"./TextInput-BAfXrpOH.js";import"./transition-pFg_ZIzI.js";import"./CameraScan-D0Az3JYB.js";function R({children:r}){c();const a=c().props.auth.user;return e.jsxs(M,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Qr Skaner"}),children:[e.jsx(E,{title:"Qr Skaner"}),a.admin?e.jsxs("div",{className:"py-12 flex",children:[e.jsx("div",{className:"w-1/2 text-center",children:e.jsx(b,{href:route("scanner.create",{mode:"device"}),active:route().current("scanner.create"),children:e.jsx(h,{children:"Czytnik"})})}),e.jsx("div",{className:"w-1/2 text-center",children:e.jsx(b,{href:route("scanner.create"),active:route().current("scanner.create"),children:e.jsx(h,{className:"justify-center",children:"Kamera"})})})]}):null,e.jsx("main",{className:"mt-10",children:r})]})}function G({mode:r}){const{props:a}=c(),{flash:o}=c().props,l=c().props.flash,[v,x]=s.useState(!1),[C,f]=s.useState(null),{data:i,setData:d,post:u,processing:P,reset:N}=F({qrCode:""}),p=e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Ostatnie Skanowania"}),Object.entries(a.lastScans).map(([t,m])=>{if(m.length<5)return;const n=JSON.parse(m);return e.jsx("p",{children:n.email?n.email:n.qrCode},t)})]});s.useEffect(()=>{if(o&&o.message){let t=e.jsxs("p",{className:"text-center",children:[o.message," ",e.jsx("br",{}),e.jsx("span",{children:a.auth.user.email})]});f(t),x(!0)}},[o]);const q=()=>{x(null),f(!1)},j=s.useRef(null),w=s.useRef(null),g=s.useRef(null),y=t=>{t.preventDefault(),u(route("scanner.store"),{onFinish:()=>{N("qrCode")}})},k=t=>{t.preventDefault(),u(route("logout"))},S=t=>{t.preventDefault(),u(route("scanner.download",{id:a.auth.user.id}))},D=async t=>{L.post(route("scanner.send"),{csvData:t})};return typeof l=="string"&&l.trim()!==""&&D(l),s.useEffect(()=>{i.qrCode&&r==="camera"&&g.current.click()},[i.qrCode]),s.useEffect(()=>{const t=m=>{setTimeout(()=>{var n;(n=j.current)==null||n.focus()},100)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),e.jsxs(e.Fragment,{children:[e.jsxs("form",{ref:w,onSubmit:y,className:"qr-form absolute top-[-9999px] h-0",children:[e.jsx(Q,{ref:j,id:"qrCode",name:"qrCode",placeholder:"QrCode",value:i.qrCode,className:"mt-1 block w-full w-4/6",autoComplete:"off",isFocused:"true",readOnly:!0,onPaste:t=>d("qrCode",t.target.value),onChange:t=>d("qrCode",t.target.value),disabled:r==="camera",required:!0}),e.jsx("button",{id:"submittt",ref:g,type:"submit",children:"Submit"})]}),r==="camera"&&e.jsx(R,{children:e.jsxs("div",{className:"text-center",children:[p,e.jsx(A,{scanned:t=>{d("qrCode",t)}})]})}),r==="device"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S,className:"absolute top-0 left-0 bg-green-500 text-white text-2xl color-white ps-4 pe-4 pt-1 pb-1 m-5 rounded",children:"Wy≈õlij Dane"}),e.jsx("button",{onClick:k,className:"absolute top-0 right-0 bg-red-500 text-white text-2xl color-white ps-4 pe-4 pt-1 pb-1 m-5 rounded",children:"Logout"}),e.jsx("div",{className:"text-center mt-20",children:p}),e.jsx(O,{})]}),v&&e.jsx("div",{className:"popup-container fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-20",children:e.jsxs("div",{className:"popup-content bg-white p-6 rounded shadow-lg w-1/3 flex flex-col items-center min-w-80",children:[C,e.jsx(h,{className:"mt-10 bg-red-500 active:bg-red-900",onClick:q,children:"Close"})]})})]})}export{G as default};
