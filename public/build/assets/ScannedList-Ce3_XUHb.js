import{r as a,j as e,a as L,V as j,M,h as S}from"./app-CPZnGP4g.js";import{A as P}from"./AuthenticatedLayout-BwnobKaf.js";import{P as f}from"./PrimaryButton-CtAVO4VB.js";import{I as Q}from"./InputError-BU0CgYgu.js";import{I as _}from"./InputLabel-CP-aBbXZ.js";import"./TextInput-CTcUtL2p.js";import"./transition-jJxcrHqb.js";function T({onChange:x}){const[d,m]=a.useState(!1),n=a.useRef(""),h=a.useRef(null);a.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){alert("SpeechRecognition is not supported");return}const i=new s;i.continuous=!0,i.lang="pl-PL",i.onresult=b=>{const p=Array.from(b.results).map(g=>g[0].transcript).join(" ");n.current+=(n.current?" ":"")+p,x(n.current)},h.current=i},[]);const o=()=>{if(!h.current)return;const s=h.current;if(d){s.stop(),m(!1);return}else s.start(),m(!0)};return e.jsx("button",{type:"button",onClick:o,className:d?"bg-red-500":"bg-green-500",children:d?"Nagrywanie... â¹ Zatrzymaj":"ðŸŽ¤ Dodaj notatkÄ™ gÅ‚osowÄ…"})}function B({noteDetails:x="",qrCode:d="unknown",user_id:m,onClose:n,target_route:h}){const{data:o,setData:s,post:i,processing:b,errors:p}=L({user_id:m,qr_code:d,note:x??""}),g=c=>{c.preventDefault(),i(route(h),{onFinish:()=>{n()}})};return e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-96 h-fit sm:w-1/2",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Edit User Details"}),o.qr_code?e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"mt-5",children:[e.jsx(_,{htmlFor:"note",value:"Notatka"}),e.jsx("textarea",{id:"note",name:"note",value:o.note,className:"mt-1 block w-full border rounded px-3 py-2 sm:h-44 h-80",onChange:c=>s("note",c.target.value),required:!0,autoFocus:!0}),e.jsx(Q,{message:p.note,className:"mt-2"})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx(T,{onChange:c=>s("note",o.note?o.note+" "+c:c)}),e.jsx(f,{className:"ml-4 bg-green-500 hover:bg-green-800",disabled:b,children:"Zapisz"}),e.jsx(f,{className:"ml-4 bg-red-500 hover:bg-red-800",onClick:n,children:"Anuluj"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-5 text-red-600",children:"Nie moÅ¼na utworzyÄ‡ notatki â€“ kod Qr nie istnieje lub jest niepoprawny."}),e.jsx("div",{className:"mt-4 ml-4 flex justify-end",children:e.jsx(f,{className:"ml-4 bg-red-500 hover:bg-red-800",onClick:n,children:"Anuluj"})})]})]})})}function H({scannerData:x,userNotes:d,user:m}){const{props:n}=j(),{flash:h,message:o}=j().props,s=j().props.flash,i=(x?x.split(";;"):[])??[],[b,p]=a.useState(!1),[g,c]=a.useState(!1),[R,q]=a.useState(!1),[D,N]=a.useState(!1),[A,y]=a.useState(null),[w,v]=a.useState(!0),E=async l=>{S.post(route("scanner.send"),{csvData:l})},k=(l,u)=>{c(l),q(u),p(!0)},I=()=>{c(null),p(!1)};a.useEffect(()=>{if(o){if(n.auth.user.email.length>30){const u=n.auth.user.email.split("@");u[0]+""+u[0]}let l=e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center",children:o}),e.jsx("p",{className:"text-xl",children:n.auth.user.email})]});y(l),N(!0)}setTimeout(()=>{C()},5e3)},[h]);const z=l=>{w&&(S.post(route("scanner.download",{id:l})),v(!1),setTimeout(()=>{v(!0)},5e3))},C=()=>{N(null),y(!1)};return typeof s=="string"&&s.trim()!==""&&E(s),e.jsxs(P,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Lista skonawania"}),children:[e.jsx(M,{title:"Qr Skaner"}),e.jsx("div",{className:"float-right me-5",children:e.jsx(f,{onClick:()=>z(m.id),className:" bg-green-500 ps-8 pe-8 pt-2 pb-2 m-5 rounded",style:{fontSize:"20px"},disabled:!w,children:"Pobierz"})}),e.jsxs("div",{className:"sm:m-5",children:[e.jsxs("table",{className:"table-auto border-collapse border border-gray-300 mt-4 max-w-full w-full sm:w-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"ID"}),e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"ImiÄ™"}),e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"Firma"}),e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"Email"}),e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"Telefon"}),e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"Kod QR"}),e.jsx("th",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:"Notatka"})]})}),e.jsx("tbody",{children:Object.entries(i).map(([l,u])=>{if(u.length<10)return null;const r=JSON.parse(u),t=d.find(F=>F.qr_code===r.qrCode);return e.jsxs("tr",{className:"align-center",children:[e.jsx("td",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:l}),e.jsx("td",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:r.name}),e.jsx("td",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:r.company}),e.jsx("td",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:r.email}),e.jsx("td",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:r.phone}),e.jsxs("td",{className:"border px-4 py-2 text-center ",children:[r.qrCode??"",e.jsxs("span",{className:"sm:hidden",children:[e.jsx("br",{}),r.email,e.jsx("br",{}),r.phone,e.jsx("br",{}),r.qrCode?e.jsx("button",{onClick:()=>k(t==null?void 0:t.note,r.qrCode??""),className:`text-white font-bold py-1 px-4 rounded ${t!=null&&t.note?"bg-green-500 hover:bg-green-700":"bg-blue-500 hover:bg-blue-700"}`,children:t!=null&&t.note?"Edytuj NotkÄ™":"Dodaj NotkÄ™"}):null]})]}),e.jsx("td",{className:"border px-4 py-2 text-center hidden sm:table-cell",children:r.qrCode?e.jsx("button",{onClick:()=>k(t==null?void 0:t.note,r.qrCode??""),className:`text-white font-bold py-1 px-4 rounded ${t!=null&&t.note?"bg-green-500 hover:bg-green-700":"bg-blue-500 hover:bg-blue-700"}`,children:t!=null&&t.note?"Edytuj NotkÄ™":"Dodaj NotkÄ™"}):"Brak Kodu QR"})]},l)})})]}),b&&e.jsx(B,{noteDetails:g,qrCode:R,user_id:m.id,onClose:I,target_route:"scanner.saveNote"})]}),D&&e.jsx("div",{className:"popup-container fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-20",children:e.jsxs("div",{className:"popup-content bg-white p-6 rounded shadow-lg w-1/3 flex flex-col items-center min-w-80",children:[A,e.jsx(f,{className:"mt-10 bg-red-500 active:bg-red-900",onClick:C,children:"Close"})]})})]})}export{H as default};
