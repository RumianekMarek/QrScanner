import{V as a,j as e,a as F,r as s,h as b}from"./app-CJ6Xl-39.js";import{A as L,N as C}from"./AuthenticatedLayout-BUZa6QS3.js";import{P as h}from"./PrimaryButton-D8LsSF9I.js";import A from"./CameraAcces-DHr_m0Ob.js";import M from"./DeviceScannerAcces-BNyBcv8_.js";import{T as O}from"./TextInput-B70UBh8I.js";import"./transition-8_TIImiH.js";import"./CameraScan-CaB01WCX.js";function Q({children:r}){a();const i=a().props.auth.user;return e.jsxs(L,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Qr Skaner"}),children:[i.admin?e.jsxs("div",{className:"py-12 flex",children:[e.jsx("div",{className:"w-1/2 text-center",children:e.jsx(C,{href:route("scanner.create",{mode:"device"}),active:route().current("scanner.create"),children:e.jsx(h,{children:"Czytnik"})})}),e.jsx("div",{className:"w-1/2 text-center",children:e.jsx(C,{href:route("scanner.create"),active:route().current("scanner.create"),children:e.jsx(h,{className:"justify-center",children:"Kamera"})})})]}):null,r]})}function W({mode:r}){const{data:i,setData:N,post:l,processing:R,reset:p}=F({qrCode:""}),{props:d}=a(),{flash:n}=a().props,c=a().props.flash,[w,f]=s.useState(!1),[y,x]=s.useState(null),[j,g]=s.useState(!0),u=s.useRef(null),v=e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Ostatnie Skanowania"}),Object.entries(d.lastScans).map(([t,o])=>{if(o.length<5)return;const m=JSON.parse(o);return e.jsx("p",{children:m.email?m.email:m.qrCode},t)})]}),S=()=>{f(null),x(!1)},k=t=>{t.preventDefault(),l(route("logout"))};s.useEffect(()=>{if(n&&g(!0),n&&n.message){let t=e.jsxs("p",{className:"text-center",children:[n.message," ",e.jsx("br",{}),e.jsx("span",{children:d.auth.user.email})]});x(t),f(!0)}},[n]);const q=t=>{t.preventDefault(),l(route("scanner.download",{id:d.auth.user.id}))};s.useEffect(()=>{const t=()=>{u.current&&u.current.focus()};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),s.useEffect(()=>{const t=async o=>{b.post(route("scanner.send"),{csvData:o})};typeof c=="string"&&c.trim()!==""&&t(c)},[c]);const D=t=>{b.post(route("scanner.store"),{qrCode:t},{onFinish:()=>{g(!1),p("qrCode")}})},E=t=>{t.preventDefault(),l(route("scanner.store"),{onFinish:()=>{p("qrCode")}})};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:E,className:"qr-form h-0 opacity-0",children:e.jsx(O,{ref:u,id:"qrCode",name:"qrCode",placeholder:"QrCode",value:i.qrCode,className:"mt-1 block w-full w-4/6 pointer-events-none opacity-0",autoComplete:"off",isFocused:!0,onChange:t=>N("qrCode",t.target.value),disabled:r==="camera",required:!0})}),r==="camera"&&j&&e.jsx(Q,{children:e.jsxs("div",{className:"text-center",children:[v,e.jsx(A,{scanned:D})]})}),r==="device"&&j&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:q,className:"absolute top-0 left-0 bg-green-500 text-white text-2xl color-white ps-4 pe-4 pt-1 pb-1 m-5 rounded",children:"Wy≈õlij Dane"}),e.jsx("button",{onClick:k,className:"absolute top-0 right-0 bg-red-500 text-white text-2xl color-white ps-4 pe-4 pt-1 pb-1 m-5 rounded",children:"Logout"}),e.jsx("div",{className:"text-center mt-20",children:v}),e.jsx(M,{})]}),w&&e.jsx("div",{className:"popup-container fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-20",children:e.jsxs("div",{className:"popup-content bg-white p-6 rounded shadow-lg w-1/3 flex flex-col items-center min-w-80",children:[y,e.jsx(h,{className:"mt-10 bg-red-500 active:bg-red-900",onClick:S,children:"Close"})]})})]})}export{W as default};
